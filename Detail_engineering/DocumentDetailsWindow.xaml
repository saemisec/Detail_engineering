<Window x:Class="Detail_engineering.DocumentDetailsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:wv2="clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf"
        xmlns:local="clr-namespace:Detail_engineering"
        Title="Document Details"
        Width="1024" Height="768"
        Background="#101218"
        WindowStyle="None" ResizeMode="NoResize" ShowInTaskbar="False">

    <Window.Resources>
        <!-- تم -->
        
        <SolidColorBrush x:Key="Panel"        Color="#171B34"/>
        <SolidColorBrush x:Key="Text"         Color="#EAF0FF"/>
        <SolidColorBrush x:Key="Accent"       Color="#5DB5FF"/>
        <SolidColorBrush x:Key="BorderColor"  Color="#26305E"/>
        <SolidColorBrush x:Key="Row"          Color="#131C3A"/>
        <SolidColorBrush x:Key="RowAlt"       Color="#0F1631"/>
        <local:FileTypeLabelConverter x:Key="FileTypeLabelConverter"/>
        <local:FileTypeBgConverter x:Key="FileTypeBgConverter"/>
        <local:FileTypeAccentConverter x:Key="FileTypeAccentConverter"/>
        <local:TreeNodeIconConverter x:Key="TreeNodeIconConverter"/>
        <local:DocTypeBadgeBgConverter x:Key="DocTypeBadgeBgConverter"/>

        <!-- TreeView استایل تیره -->
        <Style TargetType="TreeView">
            <Setter Property="Background" Value="#101218"/>
            <Setter Property="Foreground" Value="{StaticResource Text}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderColor}"/>
            <Setter Property="BorderThickness" Value="1"/>
        </Style>
        <Style TargetType="TreeViewItem">
            <Setter Property="Foreground" Value="{StaticResource Text}"/>
            <Setter Property="Padding" Value="6,3"/>
            <Setter Property="IsExpanded" Value="True"/>
            <Style.Triggers>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="#283B7A"/>
                    <Setter Property="Foreground" Value="#FFFFFF"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- DataGrid تیره -->
        <Style TargetType="DataGridColumnHeader">
            <Setter Property="Background" Value="#1A2142"/>
            <Setter Property="Foreground" Value="{StaticResource Text}"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Padding" Value="10,8"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderColor}"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
        </Style>
        <Style TargetType="DataGridRow">
            <Setter Property="Background" Value="{StaticResource Row}"/>
            <Setter Property="Foreground" Value="{StaticResource Text}"/>
            <Setter Property="BorderBrush" Value="#222C55"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
            <Style.Triggers>
                <Trigger Property="AlternationIndex" Value="1">
                    <Setter Property="Background" Value="{StaticResource RowAlt}"/>
                </Trigger>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="#283B7A"/>
                    <Setter Property="BorderBrush" Value="#3C5CC6"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- لینک -->
        <Style TargetType="Hyperlink">
            <Setter Property="Foreground" Value="{StaticResource Accent}"/>
            <Setter Property="TextDecorations" Value="{x:Null}"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Foreground" Value="#9AD1FF"/>
                    <Setter Property="TextDecorations" Value="Underline"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Border BorderBrush="{StaticResource BorderColor}" BorderThickness="1" CornerRadius="10" Background="#101218">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="48"/>   <!-- Header -->
                <RowDefinition Height="*"/>    <!-- Content -->
            </Grid.RowDefinitions>

            <!-- Header -->
            <Border Grid.Row="0" Background="{StaticResource Panel}" BorderBrush="{StaticResource BorderColor}"
                    BorderThickness="0,0,0,1" CornerRadius="10,10,0,0">
                <Grid>
                    <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column="0" Text="{Binding HeaderTitle}" Foreground="{StaticResource Text}"
                            VerticalAlignment="Center" Margin="12,0" FontWeight="SemiBold"/>
                    <Button Grid.Column="1" Content="✕" Width="32" Height="28" Margin="0,10,10,10"
                            Background="#1F2447" Foreground="{StaticResource Text}"
                            BorderBrush="#2A3162" Click="Close_Click"/>
                </Grid>
            </Border>

            <!-- Content -->
            
            <Grid Grid.Row="1" Margin="10">
                <Grid.ColumnDefinitions>
                    <!-- عرض پیش‌فرض بزرگ‌تر تا اسکرول افقی نخورد -->
                    <ColumnDefinition Width="360" MinWidth="260"/>
                    <ColumnDefinition Width="6"/>  <!-- GridSplitter -->
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- ستون چپ: TreeView بدون StackPanel تا تمام‌قد شود -->
                <Border Grid.Column="0" BorderBrush="{StaticResource BorderColor}" BorderThickness="1" CornerRadius="6">
                    <DockPanel LastChildFill="True">
                    <TextBlock Text="Document / Revisions" Foreground="{StaticResource Text}"
                                Margin="6,6,6,4" DockPanel.Dock="Top"/>
                    <TreeView x:Name="Tree"
                                ItemsSource="{Binding TreeRoots}"
                                SelectedItemChanged="Tree_SelectedItemChanged"
                                ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                Background="#101218"
                                BorderThickness="0"
                                Margin="4"
                                >
                        <TreeView.Resources>
                            <SolidColorBrush x:Key="{x:Static SystemColors.InactiveSelectionHighlightBrushKey}" Color="#1F2A57"/>
                            <SolidColorBrush x:Key="{x:Static SystemColors.InactiveSelectionHighlightTextBrushKey}" Color="#EAF0FF"/>

                            <SolidColorBrush x:Key="{x:Static SystemColors.HighlightBrushKey}" Color="#283B7A"/>
                            <SolidColorBrush x:Key="{x:Static SystemColors.HighlightTextBrushKey}" Color="#FFFFFF"/>
                        </TreeView.Resources>
                        
                        <TreeView.ItemTemplate>
                            <HierarchicalDataTemplate ItemsSource="{Binding Children}">
                                <StackPanel Orientation="Horizontal" Margin="2,0">
                                    <!-- آیکن: برای ریشه 📦، برای فرزند بر اساس Document_type -->
                                    <Border Width="18" Height="18" CornerRadius="9" Margin="0,0,8,0"
                                            Background="{Binding Doc.Document_type, Converter={StaticResource DocTypeBadgeBgConverter}}">
                                    <TextBlock HorizontalAlignment="Center" VerticalAlignment="Center" FontSize="11"
                                                Text="{Binding ., Converter={StaticResource TreeNodeIconConverter}}"/>
                                    </Border>

                                    <TextBlock Text="{Binding Title}"
                                            Foreground="{StaticResource Text}"
                                            TextTrimming="CharacterEllipsis"/>
                                </StackPanel>
                            </HierarchicalDataTemplate>
                        </TreeView.ItemTemplate>

                        <!-- استایل آيتم‌ها (بخش 4 پایین) -->
                        <TreeView.ItemContainerStyle>
                            <Style TargetType="TreeViewItem" BasedOn="{StaticResource {x:Type TreeViewItem}}">
                                <Setter Property="Padding" Value="6,3"/>
                                <Setter Property="IsExpanded" Value="True"/>
                                <EventSetter Event="Expanded"  Handler="TreeItem_Expanded"/>
                                <EventSetter Event="Collapsed" Handler="TreeItem_Collapsed"/>
                                <Style.Triggers>
                                <!-- وقتی انتخاب شده و فوکوس فعال -->
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="Background" Value="#283B7A"/>
                                    <Setter Property="Foreground" Value="#FFFFFF"/>
                                </Trigger>
                                <!-- وقتی انتخاب شده ولی فوکوس روی TreeView نیست (خواناتر) -->
                                <MultiTrigger>
                                    <MultiTrigger.Conditions>
                                    <Condition Property="IsSelected" Value="True"/>
                                    <Condition Property="IsKeyboardFocusWithin" Value="False"/>
                                    </MultiTrigger.Conditions>
                                    <Setter Property="Background" Value="#1F2A57"/>
                                    <Setter Property="Foreground" Value="#EAF0FF"/>
                                </MultiTrigger>
                                </Style.Triggers>
                                
                            </Style>
                        </TreeView.ItemContainerStyle>
                    </TreeView>
                    </DockPanel>
                </Border>

                <!-- GridSplitter برای تغییر عرض Tree -->
                <GridSplitter Grid.Column="1" Width="6" HorizontalAlignment="Stretch"
                                Background="#1B2244" ShowsPreview="True" />

                <!-- ستون راست: DataGrid فایل‌ها -->
                


                <Grid  Grid.Column="2">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*" />
                        <RowDefinition Height="500" />  <!-- ارتفاع پنجرهٔ پیش‌نمایش PDF -->
                    </Grid.RowDefinitions>
                    <TextBlock Text="Files" Foreground="{StaticResource Text}" Margin="4,0,0,6"/>
                    <DataGrid x:Name="GridFiles"
                            AutoGenerateColumns="False"
                            CanUserAddRows="False"
                            IsReadOnly="True"
                            AlternationCount="2"
                            CanUserResizeColumns="False"
                            CanUserSortColumns="False"
                            GridLinesVisibility="Vertical"
                            VerticalGridLinesBrush="#333B66"
                            Background="#101218"
                            Foreground="{StaticResource Text}"
                            SelectionChanged="GridFiles_SelectionChanged"
                            BorderBrush="{StaticResource BorderColor}" BorderThickness="1">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="FileName" Width="*" Binding="{Binding FileName, Mode=OneWay}"/>
                            <DataGridTemplateColumn Header="FileType" Width="220">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                            <Border CornerRadius="10"
                                                    Padding="8,3"
                                                    Background="{Binding FileType, Converter={StaticResource FileTypeBgConverter}}">
                                                <StackPanel Orientation="Horizontal">
                                                    <Rectangle Width="10" Height="10"
                                                            RadiusX="2" RadiusY="2"
                                                            Fill="{Binding FileType, Converter={StaticResource FileTypeAccentConverter}}"/>
                                                    <TextBlock Text="{Binding FileType, Converter={StaticResource FileTypeLabelConverter}}"
                                                            Foreground="White" FontWeight="SemiBold"/>
                                                </StackPanel>
                                            </Border>
                                        </StackPanel>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                    <Border Grid.Row="1" Margin="0,10,0,0" CornerRadius="8"
                            Background="#0F1631" BorderBrush="{StaticResource BorderColor}" BorderThickness="1">
                        <Grid>
                            <wv2:WebView2 x:Name="PdfViewer" HorizontalAlignment="Stretch" VerticalAlignment="Stretch"/>
                            <TextBlock x:Name="PdfHint" Text="Select a PDF to preview…" Foreground="#9AB0FF"
                                    VerticalAlignment="Center" HorizontalAlignment="Center"
                                    FontStyle="Italic" Visibility="Visible"/>
                        </Grid>
                    </Border>
                </Grid>
            </Grid>
        </Grid>
    </Border>
</Window>
