<UserControl x:Class="Detail_engineering.DocumentView"
             x:Name="Root"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:local="clr-namespace:Detail_engineering"
             mc:Ignorable="d" Background="#101218">
    <UserControl.Resources>
        <!-- Theme brushes (همسو با فرم اصلی) -->
        <SolidColorBrush x:Key="Bg"            Color="#101218"/>
        <SolidColorBrush x:Key="Panel"         Color="#171B34"/>
        <SolidColorBrush x:Key="Text"          Color="#EAF0FF"/>
        <SolidColorBrush x:Key="TextSubtle"    Color="#AFC6FF"/>
        <SolidColorBrush x:Key="Accent"        Color="#5DB5FF"/>
        <SolidColorBrush x:Key="Row"           Color="#131C3A"/>
        <SolidColorBrush x:Key="RowAlt"        Color="#0F1631"/>
        <SolidColorBrush x:Key="RowBorder"     Color="#222C55"/>
        <SolidColorBrush x:Key="HeaderBg"      Color="#1A2142"/>
        <SolidColorBrush x:Key="HeaderBorder"  Color="#26305E"/>
        <SolidColorBrush x:Key="SelBg"         Color="#283B7A"/>
        <SolidColorBrush x:Key="SelBorder"     Color="#3C5CC6"/>


        <Style TargetType="ContextMenu">
            <Setter Property="Background" Value="#171B34"/>
            <Setter Property="BorderBrush" Value="#26305E"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Foreground" Value="#EAF0FF"/>
        </Style>

        <!-- استایل MenuItem-->
        <Style TargetType="MenuItem">
            <Setter Property="Background" Value="#26305E"/>
            <Setter Property="Foreground" Value="#EAF0FF"/>
            <Setter Property="Padding" Value="6,3"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Style.Triggers>
                <!-- Hover -->
                <Trigger Property="IsHighlighted" Value="True">
                    <Setter Property="Background" Value="#283B7A"/>
                    <Setter Property="Foreground" Value="#FFFFFF"/>
                </Trigger>
                <!-- Checked -->
                <Trigger Property="IsChecked" Value="True">
                    <Setter Property="Background" Value="#1F2447"/>
                    <Setter Property="Foreground" Value="#5DB5FF"/>
                </Trigger>
            </Style.Triggers>
        </Style> 

        <!-- Separator رنگ تیره -->
        <Style TargetType="Separator">
            <Setter Property="Background" Value="#26305E"/>
            <Setter Property="Height" Value="1"/>
            <Setter Property="Margin" Value="2,4"/>
        </Style>

        <!-- DataGrid header style -->
        <Style TargetType="DataGridColumnHeader">
            <Setter Property="Background" Value="{StaticResource HeaderBg}"/>
            <Setter Property="Foreground" Value="{StaticResource Text}"/>
            <Setter Property="BorderBrush" Value="{StaticResource HeaderBorder}"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
            <Setter Property="FontSize" Value="13.5"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Padding" Value="10,8"/>
            <Setter Property="Height" Value="36"/>
            <Setter Property="HorizontalAlignment" Value="Center"/>
        </Style>

        <!-- DataGrid row style -->
        <Style TargetType="DataGridRow">
            <Setter Property="Background" Value="{StaticResource Row}"/>
            <!--<Setter Property="AlternationIndex" Value="{Binding RelativeSource={RelativeSource Self}, Path=AlternationIndex}"/>-->
            <Setter Property="BorderBrush" Value="{StaticResource RowBorder}"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
            <Setter Property="Height" Value="34"/>
            <Setter Property="SnapsToDevicePixels" Value="True"/>
            <Setter Property="Foreground" Value="{StaticResource Text}"/>
            <Style.Triggers>
                <Trigger Property="AlternationIndex" Value="1">
                    <Setter Property="Background" Value="{StaticResource RowAlt}"/>
                </Trigger>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="{StaticResource SelBg}"/>
                    <Setter Property="BorderBrush" Value="{StaticResource SelBorder}"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Hyperlink رنگ اکسنت -->
        <Style TargetType="Hyperlink">
            <Setter Property="Foreground" Value="{StaticResource Accent}"/>
            <Setter Property="TextDecorations" Value="{x:Null}"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Foreground" Value="#9AD1FF"/>
                    <Setter Property="TextDecorations" Value="Underline"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </UserControl.Resources>

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Search bar -->
        <DockPanel Grid.Row="0" Margin="0 0 0 10">
            <Label Content="Search:" Foreground="{StaticResource Text}" VerticalAlignment="Center" Margin="0,0,8,0"/>
            <TextBox x:Name="SearchBox"
                     MinWidth="320" Padding="8"
                     FontSize="13.5"
                     Background="#101826" Foreground="{StaticResource Text}"
                     BorderBrush="#26305E" BorderThickness="1"
                     CaretBrush="{StaticResource Accent}"
                     TextChanged="SearchBox_TextChanged"/>
        </DockPanel>

        <!-- Data Grid -->
        <DataGrid x:Name="GridDocs" Grid.Row="1"
                  AutoGenerateColumns="False"
                  CanUserAddRows="False"
                  IsReadOnly="True"
                  AlternationCount="2"
                  CanUserResizeColumns="False"
                  CanUserSortColumns="False"
                  GridLinesVisibility="Vertical"
                  VerticalGridLinesBrush="#333B66"
                  HeadersVisibility="Column"
                  RowBackground="{StaticResource Row}"
                  AlternatingRowBackground="{StaticResource RowAlt}"
                  Foreground="{StaticResource Text}"
                  Background="{StaticResource Bg}"
                  BorderBrush="{StaticResource HeaderBorder}" BorderThickness="1"
                  FontSize="13.5"
                  EnableRowVirtualization="True" EnableColumnVirtualization="True"
                  ScrollViewer.CanContentScroll="True">
            <DataGrid.Columns>
                <!-- Row.No
                <DataGridTextColumn Header="Row.No" Width="70"
                  Binding="{Binding RelativeSource={RelativeSource AncestorType=DataGridRow},
                                    Path=AlternationIndex,
                                    Mode=OneWay,
                                    Converter={x:Static local:AlternationConverter.Instance}}"/> -->

                <!-- Document_name (Hyperlink + trim) -->
                <DataGridTemplateColumn Header="Document_name" Width="*">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <TextBlock TextTrimming="CharacterEllipsis">
                                <Hyperlink Click="DocNameLink_Click">
                                    <Run Text="{Binding Document_name, Mode=OneWay}"/>
                                </Hyperlink>
                            </TextBlock>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <!-- Document_number -->
                <DataGridTextColumn Header="Document_number" Width="220"
                                    Binding="{Binding Document_number, Mode=OneWay}"/>

                <!-- Dicipline -->
                <DataGridTextColumn x:Name="ColDicipline"
                    Binding="{Binding Dicipline, Mode=OneWay}"
                    Width="200">
                    <DataGridTextColumn.Header>
                        <Grid>
                            <TextBlock Text="Dicipline" Margin="8,0,28,0" VerticalAlignment="Center"/>
                            <Button Width="18" Height="18" Padding="0"
                                HorizontalAlignment="Right" VerticalAlignment="Center" Margin="6,0,0,2"
                                ToolTip="Filter" Click="DiscBtn_Click">
                                <Path Data="M0,0 L10,0 5,6 Z" Fill="#9AD1FF"/>
                            </Button>
                        </Grid>
                    </DataGridTextColumn.Header>
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="HorizontalAlignment" Value="Center"/>
                            <Setter Property="TextAlignment" Value="Center"/>
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>


                <!-- Document_type -->
                <DataGridTextColumn x:Name="ColDocType"
                    Binding="{Binding Document_type, Mode=OneWay}"
                    Width="200">
                    <DataGridTextColumn.Header>
                        <Grid>
                            <TextBlock Text="Document_type" Margin="8,0,28,0" VerticalAlignment="Center"/>
                            <Button Width="18" Height="18" Padding="0"
                                HorizontalAlignment="Right" VerticalAlignment="Bottom" Margin="6,0,0,2"
                                ToolTip="Filter" Click="TypeBtn_Click">
                                <Path Data="M0,0 L10,0 5,6 Z" Fill="#9AD1FF"/>
                            </Button>
                        </Grid>
                    </DataGridTextColumn.Header>
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="HorizontalAlignment" Value="Center"/>
                            <Setter Property="TextAlignment" Value="Center"/>
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>
                
                

                <!-- Revisions (count excl. rejected) -->
                <DataGridTextColumn Header="Revisions" Width="120"
                                    Binding="{Binding RevisionsCountExclRejected, Mode=OneWay}">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="HorizontalAlignment" Value="Center"/>
                                            <Setter Property="TextAlignment" Value="Center"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                    
                </DataGridTextColumn>

                <!-- lastrevision (Hyperlink) -->
                <DataGridTemplateColumn Header="lastrevision" Width="120">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <TextBlock TextTrimming="CharacterEllipsis">
                                <Hyperlink Click="LastRevisionLink_Click"
                                           IsEnabled="{Binding HasLastRevision, Mode=OneWay}">
                                    <Run Text="{Binding LastRevisionName, Mode=OneWay}"/>
                                </Hyperlink>
                            </TextBlock>
                        </DataTemplate>
                        
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <!-- rejected -->
                <DataGridTextColumn Header="rejected" Width="110"
                                    Binding="{Binding RejectedCount, Mode=OneWay}">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="HorizontalAlignment" Value="Center"/>
                            <Setter Property="TextAlignment" Value="Center"/>
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>
            </DataGrid.Columns>
        </DataGrid>

        <!-- Results summary -->
        <TextBlock x:Name="ResultsText" Grid.Row="2" Margin="0,10,0,0"
                   Foreground="{StaticResource TextSubtle}" FontSize="12.5"/>
    </Grid>
</UserControl>
